@model EncuestasRC.ViewModels.SurveyCompletedViewModel

@{
    var index = 0;
    ViewBag.Title = "Encuesta Completada";
}

<div class="text-center">
    <h2 class="bg-dark text-light rounded pl-2">@Model.Title</h2>
    <input type="hidden" id="surveyId" name="SurveyId" value="@Model.surveyHeader.SurveyId" />
</div>

<div class="mt-5" id="surveyDiv">
    <div class="row mb-4">
        <div class="col-12">
            <div class="form-row">
                <div class="col-1">
                    <label class="col-form-label col-form-label-sm">Fecha</label>
                </div>

                <div class="col-2">
                    <input type="text" id="surveyDate" name="surveyDate" value="@Model.surveyHeader.SurveyEnded.Value.Date.ToString("MM/dd/yyyy")" class="datepicker form-control form-control-sm" autocomplete="off" />
                </div>
            </div>
        </div>

        <div class="col-12 mt-1">
            <div class="form-row">
                <div class="col-1">
                    <label class="col-form-label col-form-label-sm">Orden</label>
                </div>
                <div class="col-2">
                    <input type="text" id="orderNo" name="orderNo" value="@Model.surveyHeader.OrderNo" class="form-control form-control-sm" autocomplete="off" />
                </div>
                <div class="col-1">
                    <a class="btn btn-sm btn-info" href="javascript:void(0)" id="btnSearchOrder" title="Buscar" style="margin-top: 1px">
                        <i class="fa fa-search"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="col-12 mt-1">
            <div class="form-row">
                <div class="col-1">
                    <label class="col-form-label col-form-label-sm">Cliente</label>
                </div>

                <div class="col-4">
                    <input type="text" id="customer" name="customer" value="@Model.surveyHeader.Customer" class="form-control form-control-sm" />
                </div>
            </div>
        </div>

        <div class="col-12 mt-1">
            <div class="form-row">
                <div class="col-1">
                    <label class="col-form-label col-form-label-sm">Tipo</label>
                </div>
                <div class="col-2">
                    <select id="customerType" name="customerType" class="form-control form-control-sm">
                        <option value="0">--Seleccionar--</option>
                        <option value="1">Minorista</option>
                        <option value="2">Mayorista</option>
                        <option value="3">Clave</option>
                    </select>
                </div>
            </div>
        </div>

    </div>

    @foreach (var item in ViewBag.Questions)
    {
        <p class="font-weight-bold bg-light pl-1" id="question@(index)">@(index + 1)-@item.QuestionTitle</p>

        <table cellpadding="8" class="mb-4">

            <tbody>
                <tr>
                    @foreach (var answer in item.Answers)
                    {
                        var selectedAnswer = Model.surveyDetail.FirstOrDefault(c => c.QuestionId == item.QuestionId && c.AnswerId == answer.Id) != null ? "checked" : "";

                        <td>
                            <input type="radio" name="question@(index)" id="@item.QuestionId" value="@answer.Id" data-bind="@answer.Points"
                                   @(selectedAnswer)> @answer.Title
                            </td>
                        }
                </tr>
            </tbody>

        </table>

        index += 1;
    }

    <div class="form-group">
        <label for="comments"><b>Comentarios</b></label>
        <textarea class="form-control col-12" id="comments" rows="3">@Model.surveyHeader.Comments</textarea>
    </div>

    <div class="mt-2 mb-2">
        <h3>Resultado: @ViewBag.result%</h3>
    </div>

    <button class="btn btn-danger pl-5 pr-5 mt-2" id="btnBack" onclick="history.back()">Regresar</button>
</div>


@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}

<script type="text/javascript">


    $(document).ready(function () {

        $(".numericOnly").keypress(function (e) {
            if (String.fromCharCode(e.keyCode).match(/[^0-9]/g)) return false
        });
        
        $("#surveyDiv :input[type=text]").prop("disabled", true);
        $("#customerType").prop("disabled", true);
        $(':radio:not(:checked)').attr('disabled', true);

        
        $("#customerType").val(@Model.surveyHeader.CustomerType);
        
    });

</script>
